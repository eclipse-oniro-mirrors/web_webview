# Copyright (c) 2025 Huawei Device Co., Ltd.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import("//build/config/components/ets_frontend/ets2abc_config.gni")
import("//build/ohos.gni")

config("web_native_public_config") {
  visibility = [ ":*" ]
  include_dirs = [
    "native/common",
    "native/webadsblockmanager",
    "native/webasynccontroller",
    "native/webcookiemanager",
    "native/webdatabase",
    "native/webfunction",
    "native/webstorage",
    "native/webviewcontroller",
    "$target_gen_dir/../../napi/protos",
    "../../../native",
    "../../../../ohos_adapter/ohos_resource_adapter/include",
  ]
}

ohos_shared_library("webview_native") {
  public_configs = [ ":web_native_public_config" ]

  sources = [
    "$target_gen_dir/../../napi/protos/web_download.pb.cc",
    "$target_gen_dir/../../napi/protos/web_download.pb.h",
    "native/common/business_error.cpp",
    "native/common/napi_parse_utils.cpp",
    "native/common/web_errors.cpp",
    "native/webviewcontroller/native_media_player_impl.cpp",
    "native/webviewcontroller/native_media_player_impl.h",
    "native/webfunction/webview_web_inited_callback.cpp",
    #"native/webviewcontroller/native_media_player_impl.cpp",
    #"native/webviewcontroller/native_media_player_impl.h",
    #"native/webviewcontroller/web_download_delegate.cpp",
    #"native/webviewcontroller/web_download_delegate.h",
    #"native/webviewcontroller/web_download_item.cpp",
    #"native/webviewcontroller/web_download_item.h",
    #"native/webviewcontroller/web_download_manager.cpp",
    #"native/webviewcontroller/web_download_manager.h",
    "native/webviewcontroller/web_scheme_handler_request.cpp",
    "native/webviewcontroller/web_scheme_handler_request.h",
    "native/webviewcontroller/webview_controller.cpp",
    "native/webviewcontroller/webview_hasimage_callback.cpp",
    "native/webviewcontroller/webview_javascript_execute_callback.cpp",
    "native/webviewcontroller/webview_javascript_result_callback.cpp",
  ]

  deps = [
    "../../../../ohos_adapter:nweb_ohos_adapter",
    "../../../../ohos_nweb:libnweb",
    "../../../native:ohweb",
    "../../napi/protos:proto_gen",
  ]
  external_deps = [
    "ability_base:extractortool",
    "ability_runtime:app_context",
    "ace_engine:ace_container_scope",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "common_event_service:cesfwk_innerkits",
    "hilog:libhilog",
    "image_framework:image",
    "image_framework:image_native",
    "init:libbegetutil",
    "ipc:ipc_core",
    "napi:ace_napi",
    "protobuf:protobuf_lite",
    "runtime_core:ani",
    "runtime_core:libarkruntime",
    "samgr:samgr_proxy",
    "window_manager:libwm",
  ]
  part_name = "webview"
  subsystem_name = "web"
}

ohos_shared_library("webview_ani") {
  shlib_type = "ani"
  sanitize = {
    cfi = true
    cfi_cross_dso = true
    debug = false
  }

  include_dirs = [
    "./src/common",
    "./src/proxycontroller",
    "./src/webstorage",
    "./src/webadsblockmanager",
    "./src/webdatabase",
    "./src/webviewcontroller",
    "./src/webfunction",
  ]

  sources = [
    "./src/common/ani_business_error.cpp",
    "./src/common/ani_parse_utils.cpp",
    "./src/common/ani_parse_utils.h",
    "./src/webstorage/ani_web_storage.cpp",
    "./src/webadsblockmanager/ani_web_adsblock_manager.h",
    "./src/webadsblockmanager/ani_web_adsblock_manager.cpp",
    "./src/webdatabase/ani_web_data_base.cpp",
    "./src/webdatabase/ani_geolocation_permission.cpp",
    "./src/webviewcontroller/ani_webview_controller.cpp",
    "./src/webviewcontroller/ani_webview_controller.h",
    "./src/webviewcontroller/web_scheme_handler_response.cpp",
    "./src/webviewcontroller/web_scheme_handler_response.h",
    "./src/webviewcontroller/ani_web_scheme_handler_request.cpp",
    "./src/webviewcontroller/ani_web_scheme_handler_request.h",
    "./src/webviewcontroller/ani_web_scheme_handler_resource.cpp",
    "./src/webviewcontroller/ani_web_scheme_handler_resource.h",
    "./src/webviewcontroller/ani_web_scheme_handler.cpp",
    "./src/webviewcontroller/ani_web_scheme_handler.h",
    "./src/webviewcontroller/ani_web_scheme_handler_response.cpp",
    "./src/webviewcontroller/ani_web_scheme_handler_response.h",
    "./src/webviewcontroller/ani_web_download_delegate.cpp",
    "./src/webviewcontroller/ani_web_download_item.cpp",
    "./src/webviewcontroller/ani_web_download_manager.cpp",
    "./src/webviewcontroller/web_download_delegate.cpp",
    "./src/webviewcontroller/web_download_delegate.h",
    "./src/webviewcontroller/web_download_item.cpp",
    "./src/webviewcontroller/web_download_item.h",
    "./src/webviewcontroller/web_download_manager.cpp",
    "./src/webviewcontroller/web_download_manager.h",
    "./src/webviewcontroller/ani_web_cookie_manager.cpp",
    "./src/webviewcontroller/ani_native_media_player_handler.cpp",
    "./src/webviewcontroller/ani_native_media_player_handler.h",
    "./src/webviewcontroller/ani_webview_createpdf_execute_callback.cpp",
    "./src/proxycontroller/ani_proxy_config.cpp",
    "./src/proxycontroller/ani_proxy_config.h",
    "./src/proxycontroller/proxy_config.cpp",
    "./src/proxycontroller/proxy_config.h",
    "./src/proxycontroller/proxy_rule.cpp",
    "./src/webfunction/ani_webview_function.h",
    "./src/webfunction/ani_webview_function.cpp",
    "./src/sts_web_webview.cpp",
  ]

  deps = [
    ":webview_native",
    "../../../../ohos_adapter:nweb_ohos_adapter",
    "../../../../ohos_nweb:libnweb",
    "../../../native:ohweb",
    "../../napi/protos:proto_gen",
  ]
  external_deps = [
    "ability_base:extractortool",
    "ability_runtime:app_context",
    "ace_engine:ace_container_scope",
    "bundle_framework:appexecfwk_base",
    "bundle_framework:appexecfwk_core",
    "c_utils:utils",
    "common_event_service:cesfwk_innerkits",
    "hilog:libhilog",
    "image_framework:image",
    "image_framework:image_native",
    "image_framework:image_ani",
    "image_framework:image_taihe",
    "init:libbegetutil",
    "ipc:ipc_core",
    "napi:ace_napi",
    "protobuf:protobuf_lite",
    "runtime_core:ani",
    "runtime_core:libarkruntime",
    "samgr:samgr_proxy",
    "window_manager:libwm",
  ]
  part_name = "webview"
  subsystem_name = "web"
}

generate_static_abc("web_webview") {
  base_url = "./ets"
  files = [
    "./ets/@ohos.web.webview.ets",
  ]
  is_boot_abc = "True"
  device_dst_file = "/system/framework/web_webview.abc"
}

ohos_prebuilt_etc("web_webview_abc_etc") {
  source = "$target_out_dir/web_webview.abc"
  module_install_dir = "framework"
  part_name = "webview"
  subsystem_name = "web"
  deps = [ ":web_webview" ]
}
